<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/order"></ion-back-button>
    </ion-buttons>
    <ion-title>Build Your Own Pizza</ion-title>
    <ion-buttons slot="end">
      <app-settings-button></app-settings-button>
      <app-cart-button></app-cart-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="build-pizza-content">
  <div class="page-container">
    <!-- Customization Card -->
    <ion-card class="customization-card">
      <ion-card-header>
        <ion-card-title>Build Your Own Pizza</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <!-- Size Selection -->
        <div class="customization-item">
          <h3 class="item-header">
            <ion-icon name="resize-outline"></ion-icon>
            Size
          </h3>
          <ion-item class="select-item" lines="none">
            <ion-label position="stacked">Select Size</ion-label>
            <ion-select [(ngModel)]="selectedSize" interface="popover" placeholder="Choose size">
              <ion-select-option *ngFor="let size of sizes" [value]="size.id">
                {{ size.name }} <span *ngIf="size.price">- {{ size.price | currency: 'USD' }}</span>
              </ion-select-option>
            </ion-select>
          </ion-item>
        </div>

        <!-- Crust Selection -->
        <div class="customization-item">
          <h3 class="item-header">
            <ion-icon name="restaurant-outline"></ion-icon>
            Crust
          </h3>
          <ion-item class="select-item" lines="none">
            <ion-label position="stacked">Select Crust</ion-label>
            <ion-select [(ngModel)]="selectedCrust" interface="popover" placeholder="Choose crust">
              <ion-select-option *ngFor="let crust of crusts" [value]="crust.id">
                {{ crust.name }}
              </ion-select-option>
            </ion-select>
          </ion-item>
        </div>

        <!-- Sauce Selection -->
        <div class="customization-item">
          <h3 class="item-header">
            <ion-icon name="water-outline"></ion-icon>
            Sauce
          </h3>
          <ion-item class="select-item" lines="none">
            <ion-label position="stacked">Select Sauce</ion-label>
            <ion-select [(ngModel)]="selectedSauce" interface="popover" placeholder="Choose sauce">
              <ion-select-option *ngFor="let sauce of sauces" [value]="sauce.id">
                {{ sauce.name }}
              </ion-select-option>
            </ion-select>
          </ion-item>
        </div>

        <!-- Cheese Selection -->
        <div class="customization-item">
          <h3 class="item-header">
            <ion-icon name="layers-outline"></ion-icon>
            Cheese
          </h3>
          <ion-item class="select-item" lines="none">
            <ion-label position="stacked">Select Cheese</ion-label>
            <ion-select [(ngModel)]="selectedCheese" interface="popover" placeholder="Choose cheese">
              <ion-select-option *ngFor="let cheese of cheeses" [value]="cheese.id">
                {{ cheese.name }}
              </ion-select-option>
            </ion-select>
          </ion-item>
        </div>

        <!-- Toppings Selection -->
        <div class="customization-item">
          <h3 class="item-header">
            <ion-icon name="nutrition-outline"></ion-icon>
            Add Toppings
          </h3>
          <ion-item class="select-item" lines="none">
            <ion-label position="stacked">Select Toppings</ion-label>
            <ion-select [(ngModel)]="selectedToppings" multiple="true" interface="popover" placeholder="Choose toppings">
              <ion-select-option *ngFor="let topping of getAllToppings()" [value]="topping.id">
                {{ topping.name }} <span *ngIf="topping.price">(+{{ topping.price | currency: 'USD' }})</span>
              </ion-select-option>
            </ion-select>
          </ion-item>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Summary Card -->
    <ion-card class="summary-card">
      <ion-card-header>
        <ion-card-title>Your Custom Pizza</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="summary-details">
          <div class="summary-item">
            <span class="summary-label">Size:</span>
            <span class="summary-value">{{ getSelectedSizeName() }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Crust:</span>
            <span class="summary-value">{{ getSelectedCrustName() }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Sauce:</span>
            <span class="summary-value">{{ getSelectedSauceName() }}</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">Cheese:</span>
            <span class="summary-value">{{ getSelectedCheeseName() }}</span>
          </div>
          <div class="summary-item" *ngIf="selectedToppings.length > 0">
            <span class="summary-label">Toppings:</span>
            <span class="summary-value">{{ getSelectedToppingsString() }}</span>
          </div>
        </div>
        <div class="price-display">
          <span class="price-label">Total Price:</span>
          <span class="price-value">{{ getTotalPrice() | currency: 'USD' }}</span>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <ion-button expand="block" size="large" class="add-to-order-btn" (click)="addCustomPizzaToOrder()">
        <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
        Add to Cart - {{ getTotalPrice() | currency: 'USD' }}
      </ion-button>
    </div>
  </div>
</ion-content>

