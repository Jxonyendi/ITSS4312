<ion-header>
  <ion-toolbar>
    <ion-title>Order Tracker</ion-title>
    <ion-buttons slot="end">
      <app-cart-button></app-cart-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="tracker-content ion-padding">
  <section class="hero">
    <p class="eyebrow">Real-Time Tracking</p>
    <h1>Track your orders</h1>
    <p class="supporting">
      Monitor your pizza orders in real-time. See live updates on delivery status and estimated arrival time.
    </p>
    <div class="hero-chips">
      <ion-chip color="light">Live updates</ion-chip>
      <ion-chip color="light">ETA tracking</ion-chip>
    </div>
  </section>

  <div class="tracker-container">
    <!-- Active Order Section -->
    <section class="active-order-section" *ngIf="getActiveOrder() as activeOrder">
      <h2 class="section-title">Current Order</h2>
      <ion-card class="active-order-card">
        <ion-card-header>
          <ion-card-title>Order #{{ activeOrder.id }}</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-item lines="none">
            <ion-label>
              <h2>Order ID: {{ activeOrder.id }}</h2>
              <p>Status: <strong>{{ getStatusText(activeOrder.status) }}</strong></p>
              <p *ngIf="activeOrder.etaMinutes">ETA: <strong>{{ activeOrder.etaMinutes }} min</strong></p>
              <p *ngIf="activeOrder.fakeCourierName">Courier: <strong>{{ activeOrder.fakeCourierName }}</strong></p>
            </ion-label>
          </ion-item>
          <ion-button 
            *ngIf="canCancel(activeOrder)"
            expand="block" 
            color="danger" 
            (click)="cancelOrder(activeOrder)"
            class="cancel-button">
            Cancel Order
          </ion-button>
        </ion-card-content>
      </ion-card>
    </section>

    <!-- Order History Section -->
    <section class="order-history-section">
      <h2 class="section-title">Order History</h2>
      <div *ngIf="orders.length === 0" class="no-orders">
        <p>No orders yet. Place an order to see it here.</p>
      </div>
      <ion-card *ngFor="let order of orders" class="order-card" (click)="viewOrderDetails(order.id)">
        <ion-card-content>
          <ion-item lines="none" button>
            <ion-thumbnail slot="start" *ngIf="order.pizzaImage">
              <img [src]="order.pizzaImage" [alt]="order.pizzaName" loading="lazy" decoding="async" />
            </ion-thumbnail>
            <ion-label>
              <h2>Order ID: {{ order.id }}</h2>
              <p *ngIf="order.pizzaName"><strong>{{ order.pizzaName }}</strong> â€” {{ order.pizzaPrice | currency:'USD' }}</p>
              <p>Status: <strong>{{ getStatusText(order.status) }}</strong></p>
              <p *ngIf="order.etaMinutes">ETA: {{ order.etaMinutes }} min</p>
              <p *ngIf="order.fakeCourierName">Courier: {{ order.fakeCourierName }}</p>
              <p *ngIf="order.note">Note: {{ order.note }}</p>
              <p class="order-time">Placed: {{ formatDate(order.placedAt) }}</p>
            </ion-label>
          </ion-item>
        </ion-card-content>
      </ion-card>
    </section>
  </div>

  <!-- Chat Widget -->
  <app-chat-widget></app-chat-widget>
</ion-content>

