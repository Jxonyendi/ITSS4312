<ion-header>
  <ion-toolbar>
    <ion-title>Order Tracker</ion-title>
    <ion-buttons slot="end">
      <app-address-display></app-address-display>
      <app-settings-button></app-settings-button>
      <app-cart-button></app-cart-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="tracker-content ion-padding">
  <section class="hero">
    <p class="eyebrow">Real-Time Tracking</p>
    <h1>Track your orders</h1>
    <p class="supporting">
      Monitor your pizza orders in real-time. See live updates on delivery status and estimated arrival time.
    </p>
    <div class="hero-chips">
      <ion-chip color="light">Live updates</ion-chip>
      <ion-chip color="light">ETA tracking</ion-chip>
    </div>
  </section>

  <div class="tracker-container">
    <!-- Active Orders Section -->
    <section class="active-order-section" *ngIf="getActiveOrders().length > 0">
      <h2 class="section-title">Current Orders</h2>
      <ion-card *ngFor="let order of getActiveOrders()" class="active-order-card">
        <ion-card-header>
          <ion-card-title>Order #{{ order.id }}</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-item lines="none">
            <ion-thumbnail slot="start" *ngIf="order.pizzaImage">
              <img [src]="order.pizzaImage" [alt]="order.pizzaName" loading="lazy" decoding="async" />
            </ion-thumbnail>
            <ion-label>
              <h2>Order ID: {{ order.id }}</h2>
              <p *ngIf="order.pizzaName"><strong>{{ order.pizzaName }}</strong> — {{ order.pizzaPrice | currency:'USD' }}</p>
              <p>Status: <strong>{{ getStatusText(order.status) }}</strong></p>
              <p *ngIf="getRemainingETA(order) !== null">ETA: <strong>{{ getETAText(order) }}</strong></p>
              <p *ngIf="order.deliveryType"><strong>{{ getDeliveryTypeText(order) }}</strong></p>
              <p *ngIf="formatAddress(order)">{{ formatAddress(order) }}</p>
              <p *ngIf="order.fakeCourierName">Courier: <strong>{{ order.fakeCourierName }}</strong></p>
              <p *ngIf="order.note">Note: {{ order.note }}</p>
            </ion-label>
          </ion-item>
          <div class="order-actions">
            <ion-button 
              expand="block" 
              fill="outline"
              color="primary" 
              (click)="viewOrderDetails(order.id)"
              class="view-button">
              View Order
            </ion-button>
            <ion-button 
              *ngIf="canCancel(order)"
              expand="block" 
              color="danger" 
              (click)="cancelOrder(order)"
              class="cancel-button">
              Cancel Order
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>
    </section>

    <!-- Order History Section -->
    <section class="order-history-section">
      <h2 class="section-title">Order History</h2>
      <div *ngIf="getCompletedOrders().length === 0 && getActiveOrders().length === 0" class="no-orders">
        <p>No orders yet. Place an order to see it here.</p>
      </div>
      <div *ngIf="getCompletedOrders().length === 0 && getActiveOrders().length > 0" class="no-orders">
        <p>No completed orders yet.</p>
      </div>
      <ion-card *ngFor="let order of getCompletedOrders()" class="order-card" (click)="viewOrderDetails(order.id)">
        <ion-card-content>
          <ion-item lines="none" button>
            <ion-thumbnail slot="start" *ngIf="order.pizzaImage">
              <img [src]="order.pizzaImage" [alt]="order.pizzaName" loading="lazy" decoding="async" />
            </ion-thumbnail>
            <ion-label>
              <h2>Order ID: {{ order.id }}</h2>
              <p *ngIf="order.pizzaName"><strong>{{ order.pizzaName }}</strong> — {{ order.pizzaPrice | currency:'USD' }}</p>
              <p>Status: <strong>{{ getStatusText(order.status) }}</strong></p>
              <p *ngIf="getRemainingETA(order) !== null">ETA: {{ getETAText(order) }}</p>
              <p *ngIf="order.deliveryType"><strong>{{ getDeliveryTypeText(order) }}</strong></p>
              <p *ngIf="formatAddress(order)">{{ formatAddress(order) }}</p>
              <p *ngIf="order.fakeCourierName">Courier: {{ order.fakeCourierName }}</p>
              <p *ngIf="order.note">Note: {{ order.note }}</p>
              <p class="order-time">Placed: {{ formatDate(order.placedAt) }}</p>
            </ion-label>
          </ion-item>
        </ion-card-content>
      </ion-card>
    </section>
  </div>

  <!-- Chat Widget -->
  <app-chat-widget></app-chat-widget>
</ion-content>

