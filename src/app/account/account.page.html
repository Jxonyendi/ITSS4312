<ion-header>
  <ion-toolbar>
    <ion-title>Account</ion-title>
    <ion-buttons slot="end">
      <app-address-display></app-address-display>
      <app-settings-button></app-settings-button>
      <app-cart-button></app-cart-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <h1>Welcome, {{ currentUser?.username || 'User' }}</h1>

  <!-- ðŸ” PIN LOCK -->
  <ion-card *ngIf="!pinUnlocked">
    <ion-card-header>
      <ion-card-title>Payment Settings (Locked)</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-input
        type="password"
        inputmode="numeric"
        maxlength="4"
        placeholder="Enter 4-digit PIN"
        [(ngModel)]="pinInput">
      </ion-input>

      <ion-button expand="block" (click)="unlock()">
        Unlock
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- ðŸ”“ UNLOCKED CONTENT -->
  <div *ngIf="pinUnlocked">

    <!-- âœ‰ï¸ PREWRITTEN MESSAGES -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Prewritten Messages</ion-card-title>
      </ion-card-header>
      <ion-card-content>

        <p *ngFor="let m of messages">â€¢ {{ m }}</p>

        <ion-textarea
          placeholder="Create new message"
          [(ngModel)]="newMessage">
        </ion-textarea>

        <ion-button expand="block" (click)="saveMessage()">
          Save Message
        </ion-button>

      </ion-card-content>
    </ion-card>

    <!-- ðŸ• PIZZA â†’ ACTION MAPPING -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Pizza Code Mapping</ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <ion-grid>

          <ion-row *ngFor="let m of pizzaMappings; let i = index">
            <ion-col size="6">
              <ion-select [(ngModel)]="m.topping">
                <ion-select-option *ngFor="let t of toppings" [value]="t">
                  {{ t }}
                </ion-select-option>
              </ion-select>
            </ion-col>

            <ion-col size="6">
              <ion-select [(ngModel)]="m.action">
                <ion-select-option value="SMS">Send Text</ion-select-option>
                <ion-select-option value="UBER">Order Uber</ion-select-option>
                <ion-select-option value="LOCATION">Share Location</ion-select-option>
              </ion-select>
            </ion-col>
          </ion-row>

        </ion-grid>

        <ion-button expand="block" fill="outline" (click)="addMapping()">
          Add Mapping
        </ion-button>

        <ion-button expand="block" (click)="savePizzaMappings()">
          Save Settings
        </ion-button>

      </ion-card-content>
    </ion-card>

  </div>

</ion-content>
