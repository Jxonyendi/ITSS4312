<ion-modal [isOpen]="isOpen" (willDismiss)="close()" [canDismiss]="!showCheckout" [breakpoints]="[0, 0.5, 1]" [initialBreakpoint]="0.5" [backdropBreakpoint]="0.5">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Your Cart</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="close()" *ngIf="!showCheckout">
            <ion-icon name="close-outline" slot="icon-only"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content class="cart-content">
      <!-- Cart Items -->
      <div *ngIf="!showCheckout" class="cart-items-container">
        <div *ngIf="cartItems.length === 0" class="empty-cart">
          <ion-icon name="cart-outline" class="empty-icon"></ion-icon>
          <h2>Your cart is empty</h2>
          <p>Add some delicious pizzas to get started!</p>
        </div>

        <div *ngIf="cartItems.length > 0" class="items-list">
          <ion-card *ngFor="let item of cartItems" class="cart-item-card">
            <ion-card-content>
              <div class="item-header">
                <ion-thumbnail *ngIf="item.pizzaImage" class="item-thumbnail">
                  <img [src]="item.pizzaImage" [alt]="item.pizzaName" />
                </ion-thumbnail>
                <div class="item-info">
                  <h3 class="item-name">{{ item.pizzaName }}</h3>
                  <p class="item-customization" *ngIf="getCustomizationString(item)">
                    {{ getCustomizationString(item) }}
                  </p>
                  <p class="item-note" *ngIf="item.note">{{ item.note }}</p>
                </div>
              </div>

              <div class="item-footer">
                <div class="quantity-controls">
                  <ion-button
                    fill="outline"
                    size="small"
                    (click)="decreaseQuantity(item)"
                    class="quantity-btn"
                  >
                    <ion-icon name="remove-outline"></ion-icon>
                  </ion-button>
                  <span class="quantity-value">{{ item.quantity }}</span>
                  <ion-button
                    fill="outline"
                    size="small"
                    (click)="increaseQuantity(item)"
                    class="quantity-btn"
                  >
                    <ion-icon name="add-outline"></ion-icon>
                  </ion-button>
                </div>

                <div class="item-price">
                  <span class="price-label">Total:</span>
                  <span class="price-value">{{ getItemTotal(item) | currency: 'USD' }}</span>
                </div>

                <ion-button
                  fill="clear"
                  color="danger"
                  size="small"
                  (click)="removeItem(item)"
                  class="remove-btn"
                >
                  <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
                </ion-button>
              </div>
            </ion-card-content>
          </ion-card>
        </div>

        <!-- Cart Summary -->
        <ion-card *ngIf="cartItems.length > 0" class="cart-summary">
          <ion-card-content>
            <div class="summary-row">
              <span class="summary-label">Subtotal:</span>
              <span class="summary-value">{{ subtotal | currency: 'USD' }}</span>
            </div>
            <div class="summary-row">
              <span class="summary-label">Tax (8%):</span>
              <span class="summary-value">{{ tax | currency: 'USD' }}</span>
            </div>
            <div class="summary-row total-row">
              <span class="summary-label">Total:</span>
              <span class="summary-value">{{ total | currency: 'USD' }}</span>
            </div>
          </ion-card-content>
        </ion-card>

        <!-- Checkout Button -->
        <div *ngIf="cartItems.length > 0" class="checkout-section">
          <ion-button expand="block" size="large" (click)="proceedToCheckout()" class="checkout-btn">
            <ion-icon name="card-outline" slot="start"></ion-icon>
            Proceed to Checkout
          </ion-button>
        </div>
      </div>

      <!-- Checkout Form -->
      <app-checkout
        *ngIf="showCheckout"
        [cartItems]="cartItems"
        [total]="total"
        (checkoutComplete)="onCheckoutComplete()"
        (back)="showCheckout = false"
      ></app-checkout>
    </ion-content>
  </ng-template>
</ion-modal>

